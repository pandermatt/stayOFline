#!/bin/sh

[ -d build ] || mkdir build
rm build/*

cp index.html styles.css build/

MARKER_START='<!-- BUILDJS_START -->'
MARKER_END='<!-- BUILDJS_END -->'

JS_FILES=$(sed -n "/$MARKER_START/,/$MARKER_END/ { s/^.*src\=\"\(.*\)\".*/\1/p; }" index.html)
JS_FILES=$(echo $JS_FILES | tr '\n' ' ')

uglifyjs $JS_FILES -c -m -o build/lib.min.js

REPLACEMENT='<script src="lib.min.js"></script>'
sed -i '' -e "/$MARKER_START/ , /$MARKER_END/ c\\
$REPLACEMENT
"  build/index.html
